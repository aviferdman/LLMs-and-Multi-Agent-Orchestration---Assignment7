<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700" width="900" height="700">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
    <style>
      .title { font: bold 24px sans-serif; fill: #333; }
      .phase { font: bold 14px sans-serif; fill: #666; }
      .msg { font: 12px monospace; fill: #333; }
      .note { font: 11px sans-serif; fill: #888; font-style: italic; }
      .timeout { font: 10px sans-serif; fill: #e74c3c; }
    </style>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="700" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" class="title">Message Flow - Match Lifecycle</text>
  
  <!-- Actor Lines -->
  <rect x="95" y="50" width="80" height="30" rx="4" fill="#2196F3"/>
  <text x="135" y="70" text-anchor="middle" style="font: bold 12px sans-serif; fill: #fff;">League Mgr</text>
  <line x1="135" y1="80" x2="135" y2="680" stroke="#2196F3" stroke-width="2" stroke-dasharray="5,5"/>
  
  <rect x="295" y="50" width="80" height="30" rx="4" fill="#4CAF50"/>
  <text x="335" y="70" text-anchor="middle" style="font: bold 12px sans-serif; fill: #fff;">Referee</text>
  <line x1="335" y1="80" x2="335" y2="680" stroke="#4CAF50" stroke-width="2" stroke-dasharray="5,5"/>
  
  <rect x="495" y="50" width="80" height="30" rx="4" fill="#FF9800"/>
  <text x="535" y="70" text-anchor="middle" style="font: bold 12px sans-serif; fill: #fff;">Player A</text>
  <line x1="535" y1="80" x2="535" y2="680" stroke="#FF9800" stroke-width="2" stroke-dasharray="5,5"/>
  
  <rect x="695" y="50" width="80" height="30" rx="4" fill="#FF9800"/>
  <text x="735" y="70" text-anchor="middle" style="font: bold 12px sans-serif; fill: #fff;">Player B</text>
  <line x1="735" y1="80" x2="735" y2="680" stroke="#FF9800" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- Phase 1: Registration -->
  <text x="50" y="115" class="phase">1. Registration</text>
  <rect x="45" y="100" width="810" height="70" fill="rgba(33,150,243,0.1)" stroke="#2196F3" stroke-dasharray="3,3"/>
  
  <line x1="535" y1="120" x2="145" y2="120" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="340" y="115" text-anchor="middle" class="msg">LEAGUE_REGISTER_REQUEST</text>
  
  <line x1="145" y1="140" x2="535" y2="140" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="340" y="155" text-anchor="middle" class="msg">LEAGUE_REGISTER_RESPONSE (ACCEPTED)</text>
  
  <!-- Phase 2: Round Start -->
  <text x="50" y="195" class="phase">2. Round Start</text>
  <rect x="45" y="180" width="810" height="50" fill="rgba(76,175,80,0.1)" stroke="#4CAF50" stroke-dasharray="3,3"/>
  
  <line x1="145" y1="210" x2="325" y2="210" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="235" y="205" text-anchor="middle" class="msg">ROUND_ANNOUNCEMENT</text>
  
  <!-- Phase 3: Game Invitation -->
  <text x="50" y="255" class="phase">3. Game Invitation</text>
  <rect x="45" y="240" width="810" height="90" fill="rgba(255,152,0,0.1)" stroke="#FF9800" stroke-dasharray="3,3"/>
  
  <line x1="345" y1="270" x2="525" y2="270" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="435" y="265" text-anchor="middle" class="msg">GAME_INVITATION</text>
  <text x="580" y="280" class="timeout">⏱ 5s timeout</text>
  
  <line x1="525" y1="295" x2="345" y2="295" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="435" y="310" text-anchor="middle" class="msg">GAME_JOIN_ACK</text>
  
  <!-- Same for Player B -->
  <line x1="345" y1="270" x2="725" y2="270" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" stroke-dasharray="2,2"/>
  <line x1="725" y1="295" x2="345" y2="295" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)" stroke-dasharray="2,2"/>
  
  <!-- Phase 4: Parity Choice -->
  <text x="50" y="355" class="phase">4. Parity Choice</text>
  <rect x="45" y="340" width="810" height="120" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-dasharray="3,3"/>
  
  <line x1="345" y1="370" x2="525" y2="370" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="435" y="365" text-anchor="middle" class="msg">CHOOSE_PARITY_CALL</text>
  <text x="580" y="380" class="timeout">⏱ 30s timeout</text>
  
  <line x1="525" y1="400" x2="345" y2="400" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="435" y="415" text-anchor="middle" class="msg">CHOOSE_PARITY_RESPONSE ("even")</text>
  
  <line x1="345" y1="430" x2="725" y2="430" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="535" y="425" text-anchor="middle" class="msg">CHOOSE_PARITY_CALL</text>
  
  <line x1="725" y1="450" x2="345" y2="450" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="535" y="445" text-anchor="middle" class="msg">CHOOSE_PARITY_RESPONSE ("odd")</text>
  
  <!-- Phase 5: Game Over -->
  <text x="50" y="485" class="phase">5. Game Result</text>
  <rect x="45" y="470" width="810" height="70" fill="rgba(244,67,54,0.1)" stroke="#f44336" stroke-dasharray="3,3"/>
  
  <line x1="345" y1="500" x2="525" y2="500" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="345" y1="500" x2="725" y2="500" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="535" y="495" text-anchor="middle" class="msg">GAME_OVER (winner: P01, number: 8)</text>
  
  <line x1="325" y1="525" x2="145" y2="525" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="235" y="520" text-anchor="middle" class="msg">MATCH_RESULT_REPORT</text>
  
  <!-- Phase 6: Round Complete -->
  <text x="50" y="565" class="phase">6. Round Complete</text>
  <rect x="45" y="550" width="810" height="70" fill="rgba(0,150,136,0.1)" stroke="#009688" stroke-dasharray="3,3"/>
  
  <line x1="145" y1="585" x2="525" y2="585" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="145" y1="585" x2="725" y2="585" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="430" y="580" text-anchor="middle" class="msg">ROUND_COMPLETED</text>
  
  <line x1="145" y1="605" x2="525" y2="605" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="145" y1="605" x2="725" y2="605" stroke="#333" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="430" y="620" text-anchor="middle" class="msg">LEAGUE_STANDINGS_UPDATE</text>
  
  <!-- Legend -->
  <rect x="50" y="640" width="800" height="50" rx="4" fill="#fff" stroke="#ddd"/>
  <text x="70" y="660" class="note">Solid lines = Primary flow</text>
  <text x="250" y="660" class="note">Dashed lines = Parallel messages</text>
  <text x="450" y="660" class="timeout">⏱ = Timeout constraint</text>
  <text x="620" y="660" class="note">All messages use JSON-RPC 2.0</text>
</svg>
